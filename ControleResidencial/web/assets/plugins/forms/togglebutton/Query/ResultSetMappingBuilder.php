ntActivity.Core.FeedEntryInfoType.text):(n=this._linkPreview$1.linkData,t=n.url,People.RecentActivity.UI.Core.LinkHelper.isVideoLink(t)?(i=People.RecentActivity.Core.create_feedEntryVideoDataInfo(u,null,null,null,null,People.RecentActivity.Core.FeedEntryVideoDataInfoType.embed,t,t),r=People.RecentActivity.Core.FeedEntryInfoType.video):(i=People.RecentActivity.Core.create_feedEntryLinkDataInfo(u,t,n.title,null,n.description,n.thumbnailUrl),r=People.RecentActivity.Core.FeedEntryInfoType.link)),f=People.RecentActivity.Core.create_feedEntryInfo(r,null,i,null,null,null,false),People.RecentActivity.Core.create_feedObjectInfo(null,this._currentNetwork$1.id,People.RecentActivity.Core.FeedObjectInfoType.entry,f,null,0,null,null,null,null)};People.RecentActivity.UI.Share.ShareControl.prototype._updateSendButton$1=function(){this._sending$1||!this._linkPreview$1.mode&&this._characterCount$1.currentCharacterCount<1?(this._sendButtonVisible$1=false,this._sendButtonDisabled$1=true):this._characterCount$1.limitExceeded?(this._sendButtonVisible$1=true,this._sendButtonDisabled$1=true):(this._sendButtonVisible$1=true,this._sendButtonDisabled$1=false);this._processSendButtonAnimations$1()};People.RecentActivity.UI.Share.ShareControl.prototype._updateCharacterCount$1=function(n){n==null&&(n=this._canvas$1.textContent);this._characterCount$1.currentCharacterCount=People.RecentActivity.UI.Core.LinkHelper.calculateContentLength(n,this._currentNetwork$1.id)};People.RecentActivity.UI.Share.ShareControl.prototype._processSendButtonAnimations$1=function(){this._sendButtonFadeCurrent$1=this._sendButtonFadeCurrent$1.then(this._ensureSendButtonState$1.bind(this))};People.RecentActivity.UI.Share.ShareControl.prototype._ensureSendButtonState$1=function(){if(this.isDisposed)return null;if(this._sendButton$1.isDisabled=this._sendButtonDisabled$1,!this._sendButtonVisible$1&&this._sendButton$1.isVisible){var n=this;return People.Animation.fadeOut(this._sendButton$1.element).then(function(){return n.isDisposed?null:(n._sendButton$1.isVisible=false,null)})}return this._sendButtonVisible$1&&!this._sendButton$1.isVisible?(this._sendButton$1.isVisible=true,People.Animation.fadeIn(this._sendButton$1.element)):null};People.RecentActivity.UI.Share.ShareControl.prototype._isSupportedScheme$1=function(n){var t=n.schemeName.toUpperCase();return t==="HTTP"||t==="HTTPS"};People.RecentActivity.UI.Share.ShareControl.prototype._updateError$1=function(){var n=this._errorMessage$1.element,t;this._errorMessage$1.isVisible||this._lastNetworkError$1==null?this._errorMessage$1.isVisible&&this._lastNetworkError$1==null?(t=this,People.Animation.fadeOut(n).done(function(){return t.isDisposed?null:(t._errorMessage$1.isVisible=false,n.innerHTML="",t._updateCanvasHeight$1(),null)})):this._lastNetworkError$1!=null&&(n.innerHTML="",this._errorMessage$1.appendChild(this._lastNetworkError$1)):(n.innerHTML="",this._errorMessage$1.appendChild(this._lastNetworkError$1),this._errorMessage$1.isVisible=true,this._updateCanvasHeight$1(),People.Animation.fadeIn(n))};People.RecentActivity.UI.Share.ShareControl.prototype._onShareSuccess$1=function(){this._biciData$1.sendSucceeded=People.RecentActivity.Core.BiciBoolean.biciTrue;this._logBiciData$1();this._lastNetworkError$1=null;this._currentLink$1=null;this._canvas$1.clear();this._onShareCompleted$1(People.RecentActivity.Core.ResultCode.success)};People.RecentActivity.UI.Share.ShareControl.prototype._onShareCompleted$1=function(n){var t=this;People.Animation.fadeOut(this._overlay$1.element).done(function(){return t.isDisposed?null:(t._sendProgress$1.removeFromParent(),t._overlay$1.isVisible=false,t._networkSelect$1.isDisabled=false,t._canvas$1.isDisabled=false,t._linkPreview$1.isDisabled=false,t._linkPreviewClear$1.isDisabled=false,t._sending$1=false,t._updateBody$1(),t._updateError$1(),t.raiseEvent("completed",n),null)})};People.RecentActivity.UI.Share.ShareControl.prototype._clearLinkPreview$1=function(){this._currentLink$1=null;this._biciData$1.shareType=People.RecentActivity.Core.BiciShareType.text;this._updateBody$1()};People.RecentActivity.UI.Share.ShareControl.prototype._createBiciData$1=function(){var n=new People.RecentActivity.UI.Share.ShareBici;return n.hasNetworks=People.RecentActivity.Core.BiciBoolean.biciTrue,n.shareEntryPoint=People.RecentActivity.Core.BiciShareEntryPoint.inApp,n.shareType=People.RecentActivity.Core.BiciShareType.text,this._networkSelect$1!=null&&(n.socialNetworkId=this._networkSelect$1.selectedNetwork.id),n.resetHasData(),n};People.RecentActivity.UI.Share.ShareControl.prototype._logBiciData$1=function(){if(this._biciData$1!=null){var n=this._biciData$1;n.hasData&&(People.RecentActivity.Core.BiciHelper.createShareDatapoint(n.hasNetworks,n.messageLength,n.changedNetworks,n.clickedSend,n.sendSucceeded,n.shareType,n.shareEntryPoint,n.socialNetworkId,n.shareSourcePeopleApp),this._biciData$1=this._createBiciData$1())}};People.RecentActivity.UI.Share.ShareControl.prototype._createReconnectLink$1=function(){return this._reconnectLink$1==null&&(this._reconnectLink$1=new People.RecentActivity.UI.Core.Control(document.createElement("a")),this._reconnectLink$1.text=Jx.res.getString("/strings/raShareLinkReconnectNetwork"),this._reconnectLink$1.attach("click",this._onReconnectLinkClicked$1.bind(this))),this._reconnectLink$1.element};People.RecentActivity.UI.Share.ShareControl.prototype._getTwitterNickname$1=function(){var n=People.RecentActivity.Platform.Platform.getNicknameBySourceId(this._identity$1.getDataContext(),People.RecentActivity.Core.NetworkId.twitter);return Jx.isNonEmptyString(n)?People.Social.format("@{0} ",n):""};People.RecentActivity.UI.Share.ShareControl.prototype._refreshDisplayFeed=function(){if(this._currentNetwork$1.shareRefreshDelay>0){if(this._refreshTimeout===-1){var n=this;this._refreshTimeout=window.setTimeout(function(){n._refreshTimeout=-1;n._displayFeed$1.addListener("refreshcompleted",n._onDisplayFeedRefreshCompleted$1,n);n._displayFeed$1.refresh()},this._currentNetwork$1.shareRefreshDelay)}}else this._displayFeed$1.addListener("refreshcompleted",this._onDisplayFeedRefreshCompleted$1,this),this._displayFeed$1.refresh()};People.RecentActivity.UI.Share.ShareControl.prototype._onNetworkSelectPropertyChanged$1=function(n){switch(n.propertyName){case"SelectedNetwork":var t=n.sender.selectedNetwork;this._biciData$1.socialNetworkId=t.id;this._biciData$1.changedNetworks=People.RecentActivity.Core.BiciBoolean.biciTrue;this._switchNetwork$1(t)}};People.RecentActivity.UI.Share.ShareControl.prototype._onCanvasPropertyChanged$1=function(n){switch(n.propertyName){case"CharacterCount":var t=n.sender;this._biciData$1.messageLength=t.characterCount;this._updateCharacterCount$1(t.textContent);this._updateSendButton$1()}};People.RecentActivity.UI.Share.ShareControl.prototype._onCanvasLinkInserted$1=function(n){if(this._currentLink$1==null)try{var i=n.linkUrl.toUpperCase(),r=i.substr(0,4)==="WWW."?"http://"+n.linkUrl:n.linkUrl,t=new Windows.Foundation.Uri(r);this._isSupportedScheme$1(t)&&(this._biciData$1.shareType=People.RecentActivity.Core.BiciShareType.link,this._currentLink$1=People.RecentActivity.Core.create_shareOperationInfo(Windows.ApplicationModel.DataTransfer.StandardDataFormats.uri,t,null),this._updateBody$1())}catch(u){Jx.log.write(3,"Failed to parse shared URL '"+n.linkUrl+"': "+u.toString())}};People.RecentActivity.UI.Share.ShareControl.prototype._onCanvasFocusChanged$1=function(n){if(this._currentNetwork$1.id===People.RecentActivity.Core.NetworkId.twitter&&!this._identity$1.isMe){var t=this._canvas$1.textContent,i=this._getTwitterNickname$1(),r=n.focusGained;r?Jx.isNonEmptyString(t)||(this._canvas$1.textContent=i,this._canvas$1.setSelection(false)):t===i.trim()&&(this._canvas$1.textContent="")}};People.RecentActivity.UI.Share.ShareControl.prototype._onCharacterCountPropertyChanged$1=function(n){switch(n.propertyName){case"LimitExceeded":this._updateSendButton$1()}};People.RecentActivity.UI.Share.ShareControl.prototype._onSendButtonClicked$1=function(){People.RecentActivity.Core.EtwHelper.writeShareResultEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetShareStart,this._currentNetwork$1.id,People.RecentActivity.Core.ResultCode.none.toString());this._networkSelect$1.isDisabled=true;this._canvas$1.isDisabled=true;this._linkPreview$1.isDisabled=true;this._linkPreviewClear$1.isDisabled=true;this._biciData$1.clickedSend=People.RecentActivity.Core.BiciBoolean.biciTrue;this._sending$1=true;this._updateSendButton$1();this._lastNetworkError$1=null;this._updateError$1();this._overlay$1.isVisible=true;this._overlay$1.appendControl(this._sendProgress$1);this._sendProgress$1.setActive();var n=this;People.Animation.fadeIn(this._overlay$1.element).done(function(){if(n.isDisposed)return null;var t=n._currentNetwork$1.feed;return t.addListener("addentrycompleted",n._onFeedAddEntryCompleted$1,n),t.add(n._getFeedObjectInfo$1()),null})};People.RecentActivity.UI.Share.ShareControl.prototype._onFeedAddEntryCompleted$1=function(n){var t=n.sender;if(t.removeListenerSafe("addentrycompleted",this._onFeedAddEntryCompleted$1,this),n.result.code===People.RecentActivity.Core.ResultCode.success)Jx.appData.localSettings().set(People.RecentActivity.UI.Share.ShareControl.settingKey,t.network.id),this._displayFeed$1!=null&&this._displayFeed$1.initialized?this._refreshDisplayFeed():this._onShareSuccess$1();else{switch(n.result.code){case People.RecentActivity.Core.ResultCode.invalidUserCredential:this._lastNetworkError$1=People.RecentActivity.UI.Core.LocalizationHelper.loadCompoundElement("/strings/raShareErrorPermissionProblem",[document.createTextNode(this._currentNetwork$1.name),this._createReconnectLink$1()]);break;case People.RecentActivity.Core.ResultCode.userOffline:this._lastNetworkError$1=document.createTextNode(Jx.res.getString("/strings/raShareErrorNoInternetConnectivity"));break;case People.RecentActivity.Core.ResultCode.invalidPermissions:this._lastNetworkError$1=document.createTextNode(Jx.res.loadCompoundString("/strings/raShareWriteToWallError",this._identity$1.name));break;default:this._lastNetworkError$1=document.createTextNode(Jx.res.loadCompoundString("/strings/raShareErrorThirdPartyNetwork",this._currentNetwork$1.name))}this._onShareCompleted$1(n.result.code)}People.RecentActivity.Core.EtwHelper.writeShareResultEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetShareStop,t.network.id,n.result.code.toString())};People.RecentActivity.UI.Share.ShareControl.prototype._onDisplayFeedRefreshCompleted$1=function(n){n.sender.removeListenerSafe("refreshcompleted",this._onDisplayFeedRefreshCompleted$1,this);this._onShareSuccess$1()};People.RecentActivity.UI.Share.ShareControl.prototype._onLinkPreviewClearClicked$1=function(n){n.preventDefault();this._clearLinkPreview$1()};People.RecentActivity.UI.Share.ShareControl.prototype._onLinkPreviewClearKeyDown$1=function(n){switch(n.keyCode){case WinJS.Utilities.Key.space:case WinJS.Utilities.Key.enter:n.preventDefault();this._clearLinkPreview$1()}};People.RecentActivity.UI.Share.ShareControl.prototype._onReconnectLinkClicked$1=function(){var t,n,i;this._currentNetwork$1!=null&&(t=Jx.root.getPlatform().accountManager,n=t.getAccountBySourceId(this._currentNetwork$1.id,""),n!=null&&(i=new People.Accounts.FlowLauncher(Jx.root.getPlatform(),Microsoft.WindowsLive.Platform.ApplicationScenario.people,"social",Jx.root.getJobSet()),i.launchManageFlow(n,true)))};People.RecentActivity.UI.Share.ShareControl.prototype._onCanvasContainerFocus=function(n){this._linkPreview$1.isVisible||(n.preventDefault(),this._canvas$1.setSelection(false))};People.RecentActivity.UI.Share.ConnectPage=function(){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareConnectPage));this._networkControls$2=[]};Jx.inherit(People.RecentActivity.UI.Share.ConnectPage,People.RecentActivity.UI.Core.Page);People.RecentActivity.UI.Share.ConnectPage.prototype._header$2=null;People.RecentActivity.UI.Share.ConnectPage.prototype._error$2=null;People.RecentActivity.UI.Share.ConnectPage.prototype._networks$2=null;People.RecentActivity.UI.Share.ConnectPage.prototype._networkControls$2=null;People.RecentActivity.UI.Share.ConnectPage.prototype.onDisposed=function(){var n,t;if(this._header$2!=null&&(this._header$2.dispose(),this._header$2=null),this._error$2!=null&&(this._error$2.dispose(),this._error$2=null),this._networkControls$2!=null){for(n=0;n<this._networkControls$2.length;n++)t=this._networkControls$2[n],t.dispose();this._networkControls$2.length=0;this._networkControls$2=null}this._networks$2!=null&&(this._networks$2.dispose(),this._networks$2=null);People.RecentActivity.UI.Core.Page.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.ConnectPage.prototype.onRendered=function(){var t,i,e;if(People.RecentActivity.UI.Core.Page.prototype.onRendered.call(this),this._header$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-connectpage-header"),this._header$2.text=Jx.res.getString("/strings/raShareConnectPageHeader"),this._error$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-connectpage-error"),this._error$2.text=Jx.res.getString("/strings/raShareConnectPageError"),this._networks$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-connectpage-networklist"),t=People.RecentActivity.Providers.FeedProviderFactory.instance.getUserConnectableNetworks(),t.length>0){for(i=0;i<t.length;i++){var r=t[i],n=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareConnectPageNetwork)),u=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n.element,"share-connectpage-network-iconimage"),f=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n.element,"share-connectpage-network-text");this._networkControls$2.push(u);this._networkControls$2.push(f);this._networkControls$2.push(n);this._networks$2.appendControl(n);People.Animation.addTapAnimation(n.element);this._attachNetworkHandlers$2(n,r.objectId);e=u.element;e.src=r.icon;f.text=Jx.res.loadCompoundString("/strings/raShareConnectNetworkLabel",r.name)}this._header$2.isVisible=true;this._networks$2.isVisible=true;this._error$2.isVisible=false}else this._header$2.isVisible=false,this._networks$2.isVisible=false,this._error$2.isVisible=true};People.RecentActivity.UI.Share.ConnectPage.prototype._attachNetworkHandlers$2=function(n,t){var i=this;n.attach("click",function(n){i._onNetworkClicked$2(n,t)});n.attach("keydown",function(n){i._onNetworkKeyDown$2(n,t)})};People.RecentActivity.UI.Share.ConnectPage.prototype._launchReconnectFlow$2=function(n){People.RecentActivity.UI.Core.UriHelper.launchUri(People.RecentActivity.Configuration.getNetworkReconnectUrl(n,false))};People.RecentActivity.UI.Share.ConnectPage.prototype._onNetworkClicked$2=function(n,t){this._launchReconnectFlow$2(t)};People.RecentActivity.UI.Share.ConnectPage.prototype._onNetworkKeyDown$2=function(n,t){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this._launchReconnectFlow$2(t);n.preventDefault();n.cancelBubble=true}};People.RecentActivity.UI.Share.ErrorPage=function(){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareErrorPage))};Jx.inherit(People.RecentActivity.UI.Share.ErrorPage,People.RecentActivity.UI.Core.Page);People.RecentActivity.UI.Share.ErrorPage.prototype._label$2=null;People.RecentActivity.UI.Share.ErrorPage.prototype.onDisposed=function(){this._label$2!=null&&(this._label$2.dispose(),this._label$2=null);People.RecentActivity.UI.Core.Page.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.ErrorPage.prototype.onRendered=function(){People.RecentActivity.UI.Core.Page.prototype.onRendered.call(this);this.text=Jx.res.getString("/strings/raShareLoadingErrorLabel")};People.RecentActivity.UI.Share.LoadingPage=function(n){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareLoadingPage));this._dataPackageProperties$2=n};Jx.inherit(People.RecentActivity.UI.Share.LoadingPage,People.RecentActivity.UI.Core.Page);People.RecentActivity.UI.Share.LoadingPage.prototype._dataPackageProperties$2=null;People.RecentActivity.UI.Share.LoadingPage.prototype._label$2=null;People.RecentActivity.UI.Share.LoadingPage.prototype.onDisposed=function(){this._label$2!=null&&(this._label$2.dispose(),this._label$2=null);People.RecentActivity.UI.Core.Page.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.LoadingPage.prototype.onRendered=function(){People.RecentActivity.UI.Core.Page.prototype.onRendered.call(this);this._label$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-content-loading-label");this._label$2.text=Jx.res.loadCompoundString("/strings/raShareWaitingForAppProgressLabel",this._dataPackageProperties$2.applicationName)};People.RecentActivity.UI.Share.SharePage=function(n,t,i){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.sharePage));this._identity$2=n;this._shareOperation$2=t;this._biciData$2=i;this._biciData$2.shar